<h1 style="font-size: 2.5em;"> Android 消息通知</h1>
 

NotificationListenerService listener = new NotificationListenerService(){
    @Override
    public void onListenerConnected() {
    }

    @Override
    public void onListenerDisconnected() {
    }

    @Override
    public void onNotificationPosted(StatusBarNotification sbn, RankingMap rankingMap) {
    }

    @Override
    public void onNotificationRemoved(StatusBarNotification sbn) {
    }

    @Override
    public RankingMap getCurrentRanking() {
    }

    @Override
    public void onNotificationRankingUpdate(RankingMap rankingMap) {
    }
};
listener.registerAsSystemService(Context context, ComponentName componentName,int currentUser)


## 监听消息变化

## 删除消息
`````
IStatusBarService statusBarService = IStatusBarService.Stub.asInterface(ServiceManager.getService(STATUS_BAR_SERVICE));

// 删除单个消息
statusBarService.onNotificationClear(
	statusBarNotification.getPackageName(),
	statusBarNotification.getTag(),
	statusBarNotification.getId(),
	statusBarNotification.getUser().getIdentifier());
		
// 删除所有消息
statusBarService.onClearAllNotifications(ActivityManager.getCurrentUser());		
`````

## 获得消息列表
`````

@SystemApi
public StatusBarNotification[] getActiveNotifications(String[] keys, int trim) {
	if (!isBound())
		return null;
	try {
		ParceledListSlice<StatusBarNotification> parceledList = getNotificationInterface().getActiveNotificationsFromListener(mWrapper, keys, trim);
		return cleanUpNotificationList(parceledList);
	} catch (android.os.RemoteException ex) {
		Log.v(TAG, "Unable to contact notification manager", ex);
	}
	return null;
}

`````


消息中心，消息类型分类

消息应该是有分类的。

NotificationListenerWithPlugins extends NotificationListenerService
NotificationListener extends NotificationListenerWithPlugins
{

    protected NotificationPresenter mPresenter;
    protected NotificationEntryManager mEntryManager;

	onListenerConnected() {
		
        final StatusBarNotification[] notifications = getActiveNotifications();
		mPresenter.getHandler().post(() -> {
            for (StatusBarNotification sbn : notifications) {
                mEntryManager.addNotification(sbn, currentRanking);
            }
        });
	}
	
	onNotificationPosted(){
				processForRemoteInput(sbn.getNotification(), mContext);
                String key = sbn.getKey();
                mEntryManager.removeKeyKeptForRemoteInput(key);
                boolean isUpdate =
                        mEntryManager.getNotificationData().get(key) != null;
                // In case we don't allow child notifications, we ignore children of
                // notifications that have a summary, since` we're not going to show them
                // anyway. This is true also when the summary is canceled,
                // because children are automatically canceled by NoMan in that case.
                if (!ENABLE_CHILD_NOTIFICATIONS
                        && mPresenter.getGroupManager().isChildInGroupWithSummary(sbn)) {
                    if (DEBUG) {
                        Log.d(TAG, "Ignoring group child due to existing summary: " + sbn);
                    }

                    // Remove existing notification to avoid stale data.
                    if (isUpdate) {
                        mEntryManager.removeNotification(key, rankingMap);
                    } else {
                        mEntryManager.getNotificationData()
                                .updateRanking(rankingMap);
                    }
                    return;
                }
                if (isUpdate) {
                    mEntryManager.updateNotification(sbn, rankingMap);
                } else {
                    mEntryManager.addNotification(sbn, rankingMap);
                }
	}
}

RankingMap